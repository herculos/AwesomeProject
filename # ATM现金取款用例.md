# ATM现金取款用例

**参与者**  
- 主参与者：客户

**目标**  
客户通过ATM机成功提取现金。

**前置条件**  
- 客户持有有效银行卡并且账户处于活跃状态；  
- ATM设备正常运行且内有足够现金；  
- 客户知道正确的PIN码。

**后置条件**  
- 若交易成功，客户账户余额更新，ATM现金存量减少；  
- 若交易中断或异常，系统恢复至初始状态（银行卡返还或按安全策略处理）。

---

## 主要成功场景 (Main Success Scenario)

1. **插卡**  
   客户将银行卡插入ATM机。

2. **输入PIN**  
   ATM机提示客户输入PIN码。

3. **验证PIN**  
   客户输入正确的PIN码，ATM机验证无误后进入主菜单。

4. **选择取款**  
   客户在主菜单中选择“取款”功能。

5. **输入取款金额**  
   ATM机提示客户输入取款金额。

6. **确认金额与验证**  
   客户输入取款金额（例如500元），ATM机检查：  
   - 账户余额是否足够；  
   - ATM是否有足够现金满足该金额。

7. **发放现金**  
   ATM机吐出现金。

8. **后续处理**  
   ATM机更新客户账户余额，并询问客户是否需要打印收据；  
   客户做出选择后，ATM机提示是否继续其他操作。  
   若客户选择结束交易，则ATM机返还银行卡，交易结束。

---

## 扩展 (Extensions)

**3a. PIN码错误**  
- **3a.1.** 如果客户在步骤3输入错误的PIN码，ATM机显示“PIN码错误，请重新输入”。  
- **3a.2.** 系统允许客户重新输入PIN码（返回步骤2）。  
- **3a.3.** 如果客户连续输入错误3次，则：  
  - ATM机显示“您的卡已被锁定”；  
  - 执行吞卡处理，交易终止。

**5a. 取款金额格式不符合要求**  
- **5a.1.** 如果客户在步骤5输入的金额不符合ATM要求（例如，不是50元的倍数），ATM机提示“请输入有效金额（如50元的倍数）”。  
- **5a.2.** 客户需重新输入取款金额（返回步骤5）。

**6a. 账户余额不足**  
- **6a.1.** 在步骤6，如果账户余额不足以支付所输入的取款金额，ATM机显示“账户余额不足”。  
- **6a.2.** 客户可选择：  
  - 重新输入其他金额（返回步骤5）；  
  - 或取消交易（参见扩展X）。

**6b. ATM现金不足**  
- **6b.1.** 在步骤6，如果ATM内部现金不足以满足所请求的取款金额，ATM机提示“ATM现金不足，请选择其他金额或取消交易”。  
- **6b.2.** 客户可选择：  
  - 重新输入其他金额（返回步骤5）；  
  - 或取消交易（参见扩展X）。

**X. 交易取消**  
- **X.1.** 在任意步骤中，客户可选择取消交易。  
- **X.2.** ATM机显示确认取消提示。  
- **X.3.** 若客户确认取消，则ATM机返还银行卡，交易终止。  
- **X.4.** 若客户放弃取消，则继续执行当前步骤。
